## 安卓多进程

- 什么情况需要多进程

  webView、加载图片、推送、打电话、闹钟

- 为什么需要多进程

  1. 每个APP都是运行在独立的虚拟机中，虚拟机为每个进程分配的内存是有限的，单个进程内存不够了，加载大图就OOM
  2. 子进程崩溃不会影响主进程

### Binder

> 安卓专门制造的进程间通讯机制
>
> Java的进程通讯方案：共享内存、socket、消息队列、管道、信号等

- mmap

  > 通过mmap把内核空间缓存区和用户空间的内存区域，映射在同一块物理内存	

- socket实现进程间通信需要两次拷贝

  ![](https://img-blog.csdnimg.cn/img_convert/d8a0a0e7282d898ec76528ac7f286e80.png)

- binder通信为什么只需要一次拷贝

  ![](https://img-blog.csdnimg.cn/img_convert/3f9a3b6f716f8e500ff6ccd82770431c.png)

- 为什么Binder不直接把发送进程和接受进程映射在同一块内存地址

  变成了共享内存，存在多进程资源竞争问题

### 多种进程间通信方案对比

|        | Binder                             | 共享内存                               | Socket                                        |
| ------ | ---------------------------------- | -------------------------------------- | --------------------------------------------- |
| 性能   | 拷贝一次                           | 无需拷贝                               | 需拷贝两次                                    |
| 特点   | 基于C/S架构易用性高                | 控制复杂，易用性差                     | 基于C/S架构作为一款通用接口，传输效率低开销大 |
| 安全性 | 为每个App分配uid同时支持实名和匿名 | 依赖上层协议访问接入点是开放的不安全的 | 依赖上层协议访问接入点是开放的不安全          |

